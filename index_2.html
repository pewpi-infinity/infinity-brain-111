<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pixie Journal âœ¨</title>
<style>
:root{
 --bg:#0f0f14;--card:#1a1a22;--ink:#fff0f5;
 --muted:#e6b6c6;--accent:#ff7aa8;--soft:#ffd1df;--line:#3a2a35
}
html,body{
 margin:0;
 background:radial-gradient(circle at top,var(--soft),transparent 55%),linear-gradient(var(--bg),var(--bg));
 color:var(--ink);
 font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif
}
header{text-align:center;padding:22px 16px}
h1{margin:0;font-size:2rem}
.sub{color:var(--muted);font-size:.95rem;margin-top:6px}
.wrap{max-width:900px;margin:0 auto;padding:12px}
.card{
 background:var(--card);border-radius:18px;padding:16px;margin:12px 0;
 box-shadow:0 10px 32px rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.04)
}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between}
button{
 background:linear-gradient(135deg,var(--accent),#ff4f87);
 border:0;border-radius:999px;padding:10px 18px;color:#fff;font-weight:800
}
.ghost{background:#2a2432}
.meta{color:var(--muted);font-size:.85rem}
input,textarea{
 width:100%;padding:10px;border-radius:12px;border:1px solid var(--line);
 background:#120f18;color:var(--ink)
}
textarea{min-height:120px}
.post{border:1px solid var(--line)}
footer{text-align:center;color:#cfa6b8;font-size:.8rem;margin:22px 0}
</style>
</head>
<body>
<header>
 <h1>Pixie Journal âœ¨</h1>
 <div class="sub">A gentle place for notes from family & friends</div>
</header>

<div class="wrap">
 <div class="card">
  <div class="row">
   <div id="userChip" class="meta">Signed out</div>
   <div>
    <button id="btnLogin">Sign in</button>
    <button id="btnLogout" class="ghost" style="display:none">Sign out</button>
   </div>
  </div>
  <div class="meta">Only approved emails can post. Everyone can read.</div>
  <div id="allowNote" class="meta"></div>
 </div>

 <div id="composer" class="card" style="display:none">
  <h3 style="margin-top:0">Write a note to Mom ðŸ’—</h3>
  <input id="title" placeholder="Short title (optional)">
  <div style="height:8px"></div>
  <textarea id="body" placeholder="Write something kindâ€¦"></textarea>
  <div class="row" style="margin-top:10px">
   <button id="btnPost">Post</button>
   <div id="msg" class="meta"></div>
  </div>
 </div>

 <div class="card">
  <div class="row">
   <h3 style="margin:0">Latest notes</h3>
   <button id="btnExport" class="ghost">Export JSON</button>
  </div>
  <div id="feed"></div>
 </div>
</div>

<footer>Pixie Â©</footer>

<script src="./security/pewpi-auth.js"></script>
<script>
const $=(i)=>document.getElementById(i);
async function refresh(){
 const u=await window.PewpiAuth?.getUser?.()||null;
 $("userChip").textContent=u?("Signed in as "+(u.name||u.email)):"Signed out";
 $("btnLogin").style.display=u?"none":"inline-block";
 $("btnLogout").style.display=u?"inline-block":"none";
 const can=u?await window.PewpiAuth.canPost?.(u.email):false;
 $("allowNote").textContent=u?(can?"You are approved to post ðŸ’š":"Signed in â€” not approved yet."):"Sign in to write a note.";
 $("composer").style.display=(u&&can)?"block":"none";
 const posts=await window.PewpiAuth.loadPosts?.()||[];
 const f=$("feed"); f.innerHTML="";
 posts.forEach(p=>{
  const d=document.createElement("div"); d.className="card post";
  d.innerHTML=`<div style="font-weight:800">${p.title||"Note"}</div>
  <div style="white-space:pre-wrap;margin-top:6px">${p.body||""}</div>
  <div class="meta">by ${p.author||"Unknown"} â€¢ ${p.when||""}</div>`;
  f.appendChild(d);
 });
}
$("btnLogin").onclick=async()=>{await window.PewpiAuth.login?.();await refresh();};
$("btnLogout").onclick=async()=>{await window.PewpiAuth.logout?.();await refresh();};
$("btnPost").onclick=async()=>{
 const t=$("title").value.trim().slice(0,120);
 const b=$("body").value.trim().slice(0,4000);
 if(!b){$("msg").textContent="Write a little note first.";return;}
 await window.PewpiAuth.addPost?.({title:t,body:b});
 $("title").value="";$("body").value="";await refresh();
};
$("btnExport").onclick=async()=>{
 const posts=await window.PewpiAuth.loadPosts?.()||[];
 const blob=new Blob([JSON.stringify(posts,null,2)],{type:"application/json"});
 const a=document.createElement("a");a.href=URL.createObjectURL(blob);
 a.download="pixie_posts.json";a.click();URL.revokeObjectURL(a.href);
};
refresh();
</script>
</body>
</html>
